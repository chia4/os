# 操作系统期末复习

# 第1章 导论

#### 1.操作系统的作用。

操作系统是管理计算机硬件的程序，它还为应用程序提供基础，并且充当计算机硬件和计算机用户的中介。（人机交互，程序执行，资源管理）

####  2. 中断处理过程。 （重中之重，考概率很大）

CPU执行一条指令时，外设向CPU发出中断请求

CPU在满足响应的情况下，发出中断响应信号，

CPU关闭中断，不再受理另一个设备的中断

CPU寻找中断请求源（哪一个设备），并保存CPU自己的程序计数器（PC）等内容

CPU根据中断号转移到处理该中断源的中断服务程序

 CPU处理结束，恢复现场信息，开放中断，并返回到原来被中断的主程序的下一条指令

请求->响应中断->关闭中短请求服务->寻找中断请求源，保护现场->找到中断服务程序并服务->处理结束恢复现场，开放中断，回到PC的下一条指令。

#### 3. 操作系统类型（单/多道批处理系统、分时系统、实时系统）及其各自特点。

单道批处理：磁带中的各个作业按照顺序进入内存，先调入先完成，

优点：实现简单，对效率要求不高，对可靠性要求高的选择。

缺点：串行执行程序，外设和CPU之间交替空闲忙碌，利用率极低。

多道批处理系统：

内存中存放多道程序，当某道程序因某种原因如执行I/O操作时而不能继续运行放弃CPU时，操作系统便调度另一程序运行，这样CPU就尽量忙碌，达到提高系统效率的目的。

优点：提高多道程序度，提升作业吞吐量，避免了排在后面的作业饥饿，CPU和外设的利用率高。

缺点；作业平均周转时间长，运行过程不确定，没有交互能力，

分时系统：（支持多任务/多用户/多终端服务）。

CPU以很短的时间片为单位，把CPU轮流分配给每个终端使用；直到所有作业被运行完。若某个作业在分配给它的时间片内未完成计算，则该作业暂停运行，把处理器让给其他作业使用，等待下一轮再继续使用。若终端数量不多，每个终端很快就能重新获得CPU,使得每个终端得到及时响应。

特点

- 多路性：允许同一注意连接多台终端
- 独立性：用户独占一个终端
- 及时性：用户请求能及时响应。
- 交互性：可进行广泛的人机对话

缺点：不能用于系统能对于外部信息在规定的时间（比时间片的时间还短）作出处理的情况。



####  4. 多道程序设计的含义，并行和并发的区别。 

并发是同一时间间隔内看起来同时执行，但是微观上并不是同时执行，体现为多道程序在同一时间间隔内的交替执行。

并行是真正意义上的同一时刻内多处理器同时运行多个程序。

#### 5. CPU 的两种运行状态：内核态（管态）和用户态（目态）。

记住目为可见用户态即可，两者之间切换是模式位的切换。 

# 第2章 操作系统结构

####  1. 操作系统提供给用户使用的常见接口：命令行、系统调用、图形界面。 

略，见PPT

#### 2. 系统调用的处理过程及 CPU 工作状态的转换

![image-20220624111511311](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624111511311.png)

![image-20220624111659187](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624111659187.png)

####  3. 操作系统的几种主要结构及其特点。

简单结构：只提供简单，功能有限的系统。





层次结构：底层为硬件，顶层为用户接口。

分层法的主要优点是简化了构造和调试。所选的层次要求每层只能调用更低层的功能（或操作）和服务。

 主要难点在于合理定义各层

分层法与其他方法相比其效率稍差。例：用户程序执行I/O操作时，陷入I/O层→（调用）内存管理层→CPU调度层→硬件。每一层参数可能会被修改，数据可能需要传递等等。每层都为系统调用增加额外开销，系统调用需要执行更长时间



微内核：非基本部分从内核中移走，把非基本部分当作系统级程序和用户程序实现，内核很小，非基本部分是指文件系统，内存管理等程序。

好处在于易于扩展（新服务在用户空间内增加，不需要修改内核），提升OS至一个新的体系结构，更可靠（内核模式中运行代码更少），更安全，

坏处由于在各个组件之间通信需要额外CPU时间和资源。



单内核/宏内核

对设计人员要求较高。

内核中囊括了所有子程序，内存管理，文件系统，设备驱动程序等等，

优点：组件之间通信代价低，效率最高，

缺点，内核代码集成度高，对编写人员要求极高，所有模块集成道内核中，单个BUG即可让整个系统崩溃。



混合系统

windows大部分为单内核，也保留了微内核。

## 第三章：

### \1. 程序并发的概念及其特点和带来的好处。

程序并发：若干程序同时在系统中运行，程序执行在时间上是重叠的，一个程序执行未结束，另一个程序的执行已经开始。

另一种描述，两个或者多个程序在**同一时间间隔**内执行。



程序并行：两个或者多个程序在**同一时刻**内执行。



程序并发特点：

独立性，每道程序在逻辑上是独立的。

随机性：程序和数据的输入与开始执行时间都是随机的。

资源共享性：多道程序环境下执行程序的数量>计算机系统中核心数目。单CPU中，则有N－1道程序处在等待CPU的状态。同样，输入输出设备、内存、信息等资源都将被共享，将导致对进程执行速度的制约。

### \2. 进程的基本概念，进程实体的构成三要素。

进程：进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是[操作系统](https://baike.baidu.com/item/操作系统)结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。

进程实体构成三要素：

程序，数据，PCB。

### \3. 进程创建及撤销的过程。

进程创建过程：

UNIX:

fork()系统调用拷贝当前进程，创建一个子进程，子进程与父进程区别仅仅在于pid,ppid(父进程号)，和某些资源的统计量（挂起信号，），exec()函数读取可执行文件并且将子进程载入到地址空间开始运行。

linux:

首先为新进程创建一个内核栈，此时子进程的所有信息为父进程的拷贝。然后检查并确保创建该进程后，当前进程数目在分配资源限制之内，第三步，重新设置子进程中的部分信息。最后更改子进程状态。

两者创建进程都通过fork()系统调用。成功创建时，父进程返回子进程ID，子进程返回0；

copy on write(写时拷贝):资源的复制在需要写的时候才执行，在此之前以只读方式共享。



进程撤销过程（终止）：

语义之一：子进程顺序执行完最后一条指令后。显式或隐式调用exit(),要求OS将自己移除。包含两个动作：

子进程传递数据给父进程，通过父进程的wait()操作.

子进程资源(打开的文件描述符，虚存，I/O缓冲区等)被操作系统收回。

语义二，父进程强制终止子进程。有如下原因：

子进程使用了超过它所得到的资源。

分配给子进程的任务已经不在需要（执行完毕）。

父进程已经退出。有些系统不允许子子进程在父进程已经终止的情况下继续运行。如果父进程终止，它的所有子进程也会终止，成为级联终止。

僵尸进程：当前进程已经终止，但是它的父进程没有主动回收。

孤儿进程：父进程没有调用wait()就终止,以至于子进程成为孤儿进程。linux/unix解决方案为更换子进程的父进程为init超级进程。init进程是linux/unix系统中的根进程，它定期调用wait,收集孤儿进程并释放。

### \4. 进程的三种基本状态及其转换

就绪，运行，阻塞。

1）就绪-→执行：

对就绪状态的进程，当进程调度程序按一种选定的策略从中选中一个就绪进程，为之分配了处理机后，该进程便由就绪状态变为执行状态；

2）执行-→阻塞：

正在执行的进程因发生某等待事件而无法执行，则进程由执行状态变为阻塞状态。

如：进程提出输入/输出请求而变成等待外部设备传输信息的状态，进程申请资源（主存空间或外部设备）得不到满足时变成等待资源状态，进程运行中出现了故障（程序出错或主存储器读写错等）变成等待干预状态等等；

3）阻塞-→就绪：

处于阻塞状态的进程，在其等待的事件已经完成，如输入/输出完成，资源得到满足或错误处理完毕时，处于等待状态的进程并不马上转入执行状态，而是先转入就绪状态，然后再由系统进程调度程序在适当的时候将该进程转为执行状态；

4）执行-→就绪：

正在执行的进程，因时间片用完而被暂停执行，或在采用抢先式优先级调度算法的系统中,当有更高优先级的进程要运行而被迫让出处理机时，该进程便由执行状态转变为就绪状态。





### 第4章 线程

#### \1. 进程和线程的主要区别。

调度上：

进程是拥有资源基本单位，线程是CPU调度基本单位。（根本区别）

资源开销：每个进程都有独立的代码和数据空间（程序上下文），程序之间的切换会有较大的开销；线程可以看做轻量级的进程，同一类线程共享代码和数据空间，每个线程都有自己独立的运行栈和程序计数器（PC），线程之间切换的开销小。

包含关系：如果一个进程内有多个线程，则执行过程不是一条线的，而是多条线（线程）共同完成的；线程是进程的一部分，所以线程也被称为轻权进程或者轻量级进程。

内存分配：同一进程的线程共享本进程的地址空间和资源，而进程之间的地址空间和资源是相互独立的

影响关系：一个进程崩溃后，在保护模式下不会对其他进程产生影响，但是一个线程崩溃整个进程都死掉。所以多进程要比多线程健壮。

执行过程：每个独立的进程有程序运行的入口、顺序执行序列和程序出口。但是线程不能独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制，两者均可并发执行


#### \2. 用户级线程和内核级线程的主要区别。

用户级线程：受内核支持，无需内核管理。

内核级线程：由OS直接管理与支持（提供某些资源）。

多处理机中，内核能同时调度同一进程中多个线程并行执行。

#### 3. 多线程实现的 3 种模型及其特点。

多对一模型：多用户线程映射到一个内核线程

优点：线程管理由用户空间线程库执行，上下文切换代价低。

缺点：因为同一时间只有一个线程可以访问内核，一个线程执行系统调用/中断/异常，整个进程都会挂起，多线程不能并行运行在多处理机系统上



一对一模型：

优点：解决多对一模型中同一时间只有一个线程可以访问内核问题，多线程可以同时访问内核，并发功能好。

缺点：需要创建对等的内核线程，内核线程切换上下文开销大，影响程序执行性能，会限制系统支持的线程数。



多对多模型：将多个用户线程映射到少数但是不止一个内核线程上

优点：不限制线程数。多线程可以并发，一个内核线程被占用可以替换其他的内核线程提供支持

# 第5章 CPU 调度

#### 1.进程调度的作用与调度的时机。

作用：提高计算机资源利用率，提高多道程序度。

时机：当前运行进程主动放弃处理机

​		1.进程正常终止。

​		2.运行过程异常终止。（访问越界内存，内中断）

​		3.进程主动要求挂起。

，当前进程被动放弃处理机

​		1.该进程时间片用完

​		2.CPU 由紧急事务处理（外中断）

​		3，被高优先级进程抢占。

#### 2.常用调度算法的调度原则及优缺点：先来先服务、短作业优先、优先级调度、时间片轮转法、多级反馈队列

先来先服务：

对于周转时间和等待时间来说，利于长作业，不利于短作业。利于CPU密集型，不利于I/O密集型

可用于批处理系统，不适用于分时系统。

短作业优先：

优点：平均等待时间是最优的，相同时间内吞吐量也是最大的。

缺点：对长作业不利，导致长作业饥饿。未考虑作业紧迫程度，作业运行时间无法预估。

优先级调度：

动态优先权（老化优先级）法

优点：各个优先级的作业都会得到执行，

静态优先权：

缺点：优先权低的作业饥饿。

优点：考虑了作业紧迫程度。

时间片轮转：

优点：不会导致作业饥饿，平均周转时间优于SJF，相应时间优于SJF

缺点：要考虑上下文切换时间和作业需要时间比，时间比保持在1/10。

多级反馈队列

![image-20220624120904810](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624120904810.png)

![image-20220624120929417](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624120929417.png)

注意：没有最优的算法，只有最佳使用场景和算法的组合搭配才能高效完成调度任务。

补充：高相应比优先：权重为R=（处理时间+等待时间）/处理时间

优点：综合几种算法，评估效率和实现可行性最高

缺点：实时计算相应比增加了系统开销。

#### 3.调度算法及进程的完成时间，周转时间，带权周转时间，平均周转时间和平均带权周转时间计算，设备或 CPU 利用率的计算：先来先服务、短作业优先、优先级调度、时间片轮转法。

略。见作业5相关计算。



# 第6章 进程同步

####  1. 临界资源和临界区概念。

临界区：每个进程中访问临界资源的那一段程序。

临界资源：在某段时间内只允许一个进程使用的资源。



2. #### 解决临界区问题必须满足的3个条件：互斥、前进、有限等待。 

   互斥：多个进程不能同时使用同一资源

   前进（空闲让进）：没有进程处于临界区，则其他进程可以参与竞争临界区。

   有限等待：均匀分配每个进程获得临界区资源（锁）的次数。

3. #### 信号量机制及其应用。 

   信号量：进程同步工具。

   互斥锁和自旋锁：互斥锁加锁失败后自动挂起，自旋锁枷锁失败后忙等待。

   自旋锁缺点：忙等待，浪费CPU资源，

   优点，不会触发上下文切换。

   整型信号量：

   wait(s)和signal(s)操作可描述为：

    wait(S)： while S<=0 do no-op； S=S-1； signal(S)： S=S+1；

   PV原语采用原子语句构成，执行时不可被中断，同时S为互斥量。

   整型信号量缺陷：

   使得不满足条件的进程陷入忙等待浪费CPU资源。引入记录型信号量。

   结构体信号量:

   除了需要一个用于代 表资源数目的整型变量value外，还应增加一个进程链 表指针L，用于链接申请该资源的所有等待进程。(PPT上有详细介绍)

   AND型信号量：

   在有些应用场合，进程需要获得两个或更多的共享资源后方能执行其任务。

   基本思想是：进程一次性申请所需全部资源，使用 完后再一起释放。

   对若干个临界资源的分配，采取原子操作方式：要么把它所请求的 资源全部分配到进程，要么一个也不分配。

   信号量集：满足进程执行需要多个临界资源的情况。

   优先级倒置：当前OS广泛采用优先级调度算法和抢占式，然而 在系统中存在着影响进程运行的资源而可能产生“优先 级倒置”的现象，即高优先级进程(或线程)被低优先级 进程(或线程)延迟或阻塞。

   解决：

   1.禁止进入临界区后被抢占。

   2.动态优先级继承。高优先级进程进入临界区时发现低优先级进程正在使用该资源，一方面，阻塞高优先级进程，一方面，低优先级进程获得该进程优先级。并且一直保持到其退出临界区。可以防止中优先级进程插入。

   

4. #### 使用信号量解决进程同步问题。

   生产者-消费者问题：

   两者贡献一个有界缓冲池。两者互斥进入缓冲池放入/取出资源。

   同步条件：

   只有在缓冲池中至少有一个缓冲区已存入消息后，消费者才能 从中提取消息，否则消费者必须等待。 

   只有缓冲池中至少有一个缓冲区是空时，生产者才能把消息放 入缓冲区，否则生产者必须等待。

   wait和signal必须成对出现，否则死锁！

   读写问题:
   可以同时读但不能同时写！

   读优先。存在读取进程时，写进程挂起。导致写进程饥饿。

   写优先：写进程存在时挂起读进程。

   哲学家就餐问题：

   最多允许4个哲学家同时去拿左边的筷子

#### 5.硬件同步，软件同步

硬件同步是指CPU制造者为临界区资源提供的硬件支持：即为禁止中断，专用机器指令（原子特征指令），关中断。

testandset指令(TS)

```c
boolean TestAndSet (boolean *target)
{
boolean rv = *target;
*target = TRUE;
return rv:
}
```

SWAP指令

```c
void Swap (boolean *a, boolean *b)
{
boolean temp = *a;
*a = *b;
*b = temp:
}

```

硬件同步优点：使用范围广泛，使用简单，支持多个临界区

缺点：不满足弹性等待，导致进程饥饿。



软件同步让并发进程自己通过软件完成，不需要OS 支持。

单标志算法

定义两进程共享数据 ◦ int turn; 并且取初值 turn = 0 , turn = i 则进程Pi 可以进入临界区 

进程Pi;

```c
do {
while (turn != i) ; /* do nothing
critical section
turn = j;
remainder section
} while (1);
```

单标志算法满足互斥但是不满足前进：即没有进程处于临界区，则其他进程可以进入或竞争临界区。



双标志位算法（先修改后检查算法）peterson算法

两进程共享数据 ：

boolean flag[2]; 并且取初值 flag [0] = flag [1] = false ，

flag [i] = true 表示进程Pi 发出申请，希望进入临界区执行

进程Pi

```C
do {
flag[i] = true;
while (flag[j]) ; /* do nothing 
critical section
flag [i] = false;
remainder section
} while (1);
```

Pi想进入临界区先检查对方flag，若对方不想 进入则自己进入，若对方想进入，则检查 turn,由于turn中保存的是较晚的一次赋值， 因此较晚修改turn的进程等待

进程Pj

```c
while (true) {
flag[j] = TRUE;
turn = i;
while ( flag[i] && turn == i); /* do nothing
CRITICAL SECTION
flag[j] = FALSE;
REMAINDER SECTION
}
```

peterson 算法满足临界区问题的三个条件，互斥，空闲让进，有限等待。

# 第7章 死锁 

#### 1.什么是死锁？死锁产生的原因。

多个进程竞争贡献资源造成僵局。无外力作用，这些进程永远不能前进，称为死锁进程

死锁产生的原因：

1.竞争资源。2.进程推进顺序不合法。



####  2. 死锁的 4 个必要条件。

互斥：一个资源一次只能被一个进程占用。

不可抢占：资源仅能被占有者释放，不能由其他进程抢占。

循环等待：P1等待P2释放资源，P2等待P1释放资源。

请求保持：（部分分配）：进程已经保持至少一个资源，又提出资源请求，但是该资源被其他进程占有，请求者阻塞，已经获得的资源得不到释放。

####  3. 死锁预防所采用的策略。 

预防死锁策略：（静态）

破坏四个必要条件之一即可（破坏互斥 spooling假脱机技术。静态分配进程所需所有资源，破坏请求保持状态）

#### 4. 采用银行家算法判断系统安全性及避免死锁。

避免死锁：（动态）

安全序列：如果系统按照这种序列分配资源，则每个进程都能顺利完成，只要能找出一个安全序列，系统就是安全状态，安全序列可能有多个。

安全状态一定不会死锁，不安全状态不一定 死锁。

####  5. 解除死锁的两种常用方法。

重启计算机（逃！）

1.资源剥夺：挂起死锁进程，抢占他的资源并分配给死锁进程，RR算法防止挂起进程饥饿。

2.撤销进程：强制撤销部分，甚至一组死锁进程，并剥夺他们的资源，

终止进程带来的后果就是长时间执行的结果功亏一篑。

（3.进程回退，让一个死锁进程回退到避免死锁的代码，要求OS记录进程历史信息，设置代码还原点。）

# 第八章  内存管理

#### 1.逻辑地址与物理地址关系

逻辑地址：是指由程序产生的与段相关的偏移地址部分。又称绝对地址。

物理地址：整个内存单元上的的地址。

逻辑地址可以通过偏移量映射到物理地址。

####  2. 连续内存分配常用的几种分区分配算法要点及其优缺点：首次适应算法，最优适应算法，最坏适应算法。 

首次适应：分配第一个足够大的内存区域

缺点：小外碎片多。

优点：该算法倾向于优先利用内存中低地址部分分区，保留高地址部分大空闲区域，有利于以后到达的大作业。

最优适应算法：分配最小的能满足作业的内存。

缺点：小外碎片多。

优点：使外部碎片尽量最小。

最坏适应：给作业分配最大的块。

缺点：大作业的分区要求无法满足。

优点：使得剩下的空闲分区不至于太小，产生碎片几率最小，对中小作业有利，算法查找效率高。

通过**紧缩**减少外部碎片。（紧凑时间代价高昂）。

#### 3. 分页式存储管理的原理及多级页表结构。 

前提：进程并不要求逻辑地址连续。

分页式内存管理：把物理地址空间分成长度一致的块，称为“页帧或者页框（frams）”,OS 管理空闲页帧。分页式内存管理不存在外碎片。内存中存放一个页表，其中每一个页表项中有页起始地址与偏移量，通过起始地址+偏移可以得到物理地址。

**2的页内偏移量幂次等于页面大小！！！**

**进程最多拥有2的页号位幂次个页面！！！**

单级页表存在的问题：

1.页表必须连续存放，页表很大时，需要占用很多个连续的页框，耗内存。

2.没有必要让整个页表常驻内存，由于局部性原理，进程在一段时间之内可能只需要访问几个特定的页面。

 多级页表结构：将大规模页表分组，使得每个内存块刚好可以放进一个分组。为离散的页表建立一张页表，称为页目录表或者外层/顶层页表。

 注意！：多级页表中各级页表大小不能超过一个页面。多级页表访存为N+1次。

#### 4. 分页式存储管理模式下的地址变换过程——地址重定位。

**注意是否越界！（内中断）**

####  5. 平均页面访问时间的计算。

  **注意有没有快表，命中问题！以及快表慢表同时查询。！！！**

#### 6. 分页与分段的比较。

分段内存管理：

进程的地址空间：按照程序自身的逻辑关系划分为若干个段，每个段都有一个段名，从0开始给段编号，段在内存中占据连续空间，但是各段之间可以不相邻。 

逻辑地址由段号与段内地址组成

段表下标即为段号，段表条目由段长和基地址构成。

进程切换相关内核程序负责回复进程运行环境。系统区域的PCB存放段表寄存器（段表始址和段表长度（防止越界））。

段号位数决定每个进程可以分多少段。段内地址决定每段长度是多少。（同分页式）。



比较：

页是信息物理单位。分页目的实现离散分配，提高内存利用率。分页仅仅是系统管理需要，对用户不可见，仅仅产生外碎片

段时信息的逻辑单位。分段目的时满足用户需求，一个段包含一组属于一个逻辑模块的信息。分段对用户是可见的，用户编程时需要显式地给出段名。仅产生内碎片。分段比分页更容易实现信息共享和保护。

#### 补充覆盖与交换：（内存扩充技术 ps：虚拟内存）

覆盖：

将程序分为多个段，常用段常驻内存，不常用段需要时调入内存。

覆盖区的大小由同级段最大者或者互斥层级之间最大者决定。

早期操作系统使用这种模式，增加用户编程负担，容易出错。

交换：中级调度：内存空间紧张时，系统将内存中某些进程暂时换出外存，把外存中已经具备运行条件的进程换入内存（进程在内存与磁盘之间动态调度）。信息存储在PCB中，便于恢复现场。

低级调度决定进程是否运行，高级调度决定进程是否进入就绪队列。

磁盘存在对换区以及文件区，对换区连续分配，文件区离散分配提高空间利用率。连续分配的寻道时间和





**补充段页式：**

段页式由段来组织页：逻辑地址由段号，页号，页内偏移量组成。

需要三次访存先查询段表，然后页表，然后内存。

引入快表，用段号和页号作为关键字，若快表命中则仅仅需要一次访存。快表在CPU高速缓存中！

# 第9章 虚拟内存 

#### 引入虚拟内存技术前提：

传统存储管理连续分配（单一连续分配，固定分区分配，动态分区分配），非连续分配（页式分配，段式分配，段页式）有致命缺陷：一次性即为作业必须一次性全部装载进入内存才能执行，造成大作业无法运行，以及大量作业无法同时运行，降低多道程序并发度。驻留性：作业一旦装入内存，就会一直驻留内存，导致内存中会存在大量不会被用到的作业。降低系统吞吐量。



#### 1.虚拟存储器的实现原理。 

由于局部性原理，进程只需要一部分代码和数据即可运行，内存中只需要有支持进程运行的代码段和数据段即可。在程序执行过程中，如果需执行的指令或访问的数据 尚未在内存（称为缺页或缺段），则由处理器通知操 作系统将相应的页或段调入到内存，然后继续执行程 序。另一方面，操作系统将内存中暂时不使用的页或段调 出保存在外存上，从而腾出空间存放将要装入的程序 以及将要调入的页或段。

#### 2. 虚拟存储器最大实际容量的计算。

最大容量=CPU寻址范围。

虚拟内存实际容量=min(内存外存之和，CPU寻址范围)。

####  3. 页面置换算法及缺页次数和缺页率的计算：最佳置换算法 OPT、先入先出算法 FIFO、 最近最久未使用算法 LRU。 

注意：LRU需要专业硬件支持！

没有被修改过的页面不用写回。

时钟置换在OPT和LRU之间。

#### 4. 工作集原理及相关计算

工作集（驻留集）是指在某段时间内，进程要访问的页面集合。进场被使用的页面需要在工作及中，而长期不被使用的页面要从工作集中被丢弃，为了防止系统出现抖动现象，需要选择合适的工作集大小。

工作集模型的原理是：让OS跟踪每个进程的工作及，并且为进程分配大于其工作集的物理块。若还有空闲物理块，则可以调入进程增加多道程序度，如果所有工作集之和增加大于可以分配的空闲物理块。那么OS会挂起一个进程，将其页面调出分配给其他进程，防止抖动。



#### 补充：虚拟内存三个特征：

多次性：无需将作业一次性装入内存，允许被分成多次调入内存

对换性：作业运行时代码和数据段无需常驻内存，允许换入换出

虚拟性：逻辑上扩充了内存容量，使用户看到内存远大于实际容量。



#### 补充：

虚拟内存的多次性，如果采用连续分配方式，不方便实现。因此，虚拟内存实现建立在离散分配的内存管理方式基础上。



#### 补充调入内存的方式：

请求页面置换（主流）

请求段置换

请求段页置换

#### 补充：抖动（颠簸）

 虚存中，页面在内存与磁盘之间频繁调度，使得 调度页面所需时间比进程实际运行的时间还多，导致系统效率急 剧下降，这种现象称为抖动或颠簸。

# 第10章 文件系统接口 



#### 1.文件的打开和关闭。

打开文件
传送文件名到逻辑文件系统

 在目录中搜索给定文件名
读入该文件的FCB
将FCB添加到系统打开文件表中
在进程打开文件表中增加一条目，在条目中填入指向系统打开文
件表的指针及其他信息
 返回进程打开文件表中的相关指针 (文件描述符；文件句柄）

关闭文件：

删除进程打开文件表中的相关条目
系统打开文件表对应条目的打开记数减1 

如果打开记数为 0, 基于目录结构，将修改后的文件信息拷贝到磁盘上，后删除该条目。



####  2. 文件的逻辑结构和物理结构。 

逻辑结构：用户对文件的组织结构（要求：提高检索速度，便于修改文件，减少文件占用空间）

物理结构：文件在外存上的存储结构。

#### 3. 文件的两种访问方式：顺序访问、直接（随机）访问。

顺序访问（基于磁带模型，编辑器和编译器通常按此方式访问文件）

直接访问：读写第N个记录，定位到N个记录，N是文件相对块号。

####  4. 文件目录的作用。 

文件目录：将文件名转换为文件在外存的物理位置的功能，具体的说：实现按名存取，提高对目录检索速度，文件共享，允许文件重名。

#### 5. 文件目录的 3 种结构原理及优缺点：单层结构目录、双层结构目录、树状结构目录。

文件控制块：FCB是文件首部，它包含了与文件有关的说明和控制信息，它对用户是透明的。随着文件创建与删除。

有效：迅速定位文件

命名：方便用户两个不同的用户的文件名称可以相同同一文件可以有不同的名称。

分组：按文件的属性逻辑分组（如所有java程序，所有游戏等）

单级目录：

优点：便于编写代码支持和理解。

缺点：存在命名冲突和分组问题，查找速度极慢。

两级结构目录：（为不同用户建立不同目录，不同用户的文件允许同名，不允许分组）

提高文件检索速度，不便于共享。具有隐私性。

优点：解决了文件命名冲突问题。具有隐私性

缺点：不便于共享。

树形目录结构：

优点：检索速度极快，解决了分组，命名冲突，问题，层次结构清晰。不同目录，不同用户的文件可以构成不同目录子树，不同层次，不同用户的文件分别呈现在系统目录树中的不同层次或者不同子树中，可以轻松赋予不同存取权限。

缺点：树形目录查找文件需要按路径名逐级访问中间节点，增加访盘次数，影响查询速度。

unix/linux/windows都采用了树形目录结构，树形目录结构禁止共享文件和目录。

####  6. 绝对路径与相对路径。

绝对路径指当前目录内的路径，相对路径指根目录下的路径。





补充：无结构文件（文本文件）--由二进制或者字符流组成，称为流式文件，简单记录结构与复杂结构文件。

补充：读文件写文件：将文件数据读入内存，并写回。

# 第11章 文件系统实现 

前提：文件的存储设备通常划分为大小相等的物理块，物理块是分配及传输信息的基本单位。

#### 1.几种外存分配方式原理及优缺点：连续分配、链接分配（隐式链接、显示链接）、索引 分配。

连续分配：（顺序结构）

将逻辑上连续的文件信息依次存放在外存连续的物理块中

优点：简单，只需要记录文件起始位置和长度

  		访问文件容易，寻道时间少。

​		  支持顺序和随机访问。

缺点：

为新文件找到空间困难，文件难以增长（基于拷贝开销带来的困难），存在外碎片



链接分配：（显式链接结构，隐式链接结构）

隐式链接：构成文件的物理块离散存放于磁盘，文件entry包括起止物理块。

优点：索引简单，只需要起始位置。提高磁盘利用率，解决外碎片问题，便于拓展，有利于文件插入和删除（链表的优点，高性能增删）。

缺点：

有效支持顺序访问，不便于随机访问--存取速度慢。（记忆为链表的低性能查找，数组的高性能查找。）  致命问题：更多寻道次数带来时间开销，块于块之间链接指针占用空间。连接指针的错误或丢失造成文件存在可靠性的问题。（使用双向链表或者在每块中存入文件名和相对块数，可靠性提高，降低了空间利用率）。



显式链接：

可见的文件分配表（FILE ALLOCATION TABLE）

目录存放文件名以及起始块，通过FAT查询一条物理块链。FAT常驻内存。

优点：支持随机访问，便于拓展，无碎片，地址映射不需要访盘，节约时间

缺点：常驻内存带来的空间开销。





索引分配：

将所有的数据块指针集中到索引块中 

 索引块中的第i个条目指向文件的第i块。
目录条目包括索引块的地址

优点：

保持了链接结构的优点,又解决了其缺点：既能顺序存取，又能随机存取；满足了文件动态增长、插入删除的要求，也能充分利用外存空间。

缺点：

当文件物理空间过于离散时，寻道次数带来高开销，且同样占用存储空间，同时对OS设计者要求肥肠高。

略链接索引，多层索引，混合索引。

####  2. 使用一级索引和二级索引时，文件系统支持的最大文件长度计算。 

略。

#### 3. 外存空闲空间管理的几种常用方法。

成组链接法：把空闲空间按照固定大小分组，每组最后一块用来存放后一组的各块块号以及块数，

空闲表法：为空闲区建立空闲表，每个空闲区域对应一个空闲表项，包块空闲块数等信息。

####  4. 位示图（位向量）的原理及相关计算。

位图原理：用二级制的一位来表示磁盘中一个盘块的使用情况，磁盘上所有的盘块和/磁盘簇都有一个二进制位与之对应。0表示空闲，

位图优点：很容易找到一组相邻的空闲块，本身占用空间小，常驻内存，盘区分配时无需访盘。

#  第12章 大容量存储器的结构

####  1. 磁盘容量的计算：盘面数*每个盘面上的磁道数*每条磁道上的扇区数*扇区大小。 

略

#### 2. 磁盘访问时间的构成：寻道、旋转延迟、数据传输及计算。

平均比较：寻道时间>旋转时间>数据传输>>计算

####  3. 磁盘调度算法原理及平均寻道长度的计算：先来先服务 FCFS、最短寻道时间优先 SSTF、电梯调度算法 LOOK、循环扫描算法 C-LOOK。

计算平均寻道时间时只需要计算拐点差值即可。

#### 4. 各级 RAID 的主要特点。

![image-20220624095404206](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624095404206.png)

0级：

​		优点：简单并行访问，实现高效传输，以及I/O请求。

​		缺点：没有冗余备份，可靠性不高

1级：

​		优点：可靠性好，由灾备处理。

​		缺点，磁盘利用率50%。

2级：3级都是并行访问，优点同0级，相应I/O请求量大。

4，5，6级为独立访问

4级：采用块交叉奇偶校验结构进行数据容错，设置了一校验盘，每次 写操作都需要奇偶校验盘参与，校验盘可能成为阵列的瓶颈。 RAID4~RAID6都采用了独立访问技术 

RAID5：采用块交叉奇偶校验结构进行数据容错，每个驱动器都有各自独 立的数据通路，独立地进行读写，数据的读写速度较快。无专门的校验盘 ，校验信息分散在所有数据盘上 。

RAID6：P+Q两种校验方式，具有极高的数据可用性。

ps: raid 0+1为0，1组合体，特殊性能介于两者之间。

# 第13章 I/O 系统 

#### 1. 4 种 I/O 访问方式：轮询的 I/O、中断驱动的 I/O、DMA 直接内存访问、通道。 

轮询I/O缺点，cpu处于忙等待，无法处理其他请求，效率低下，

优点：实现简单，也有特定场景需要轮询I/O.

中断驱动IO:

cpu硬件中由一条专门的中断请求线（interrupt-request line ,IRL）,cpu执行完每条指令后都检测IRL，当检测到由控制器通过IRL发送信号，CPU保存当前状态并跳转到内存固定位置的中断处理程序

中断处理程序判断终端原因，进行必要处理，重新回复状态，最后执行中断返回指令。使得cput返回中断前的执行状态。

设备控制器通过IRL发送信号引起中断，CPU捕获中断并分发到中断处理程序中，中断处理程序通过处理设备请求清除中断。

中断驱动的I/O是异步的，CPU无需忙等待即可检测到I/O请求并相应

优点：CPU 与外设可以并行异步工作，CPU利用率高，并且支持多道程序和设备的并行工作

缺点：设备控制器的数据寄存器装满数据后发生中断，数据寄存器通常只能存放一个字节的数据，因此在进程传送数据过程中，发生中断次数可能很多，将消耗CPU大量时间

计算机搭载外设多，若都通过中断方式进行数据传送，则会由于中断次数急剧增加造成CPU无法及时响应中断，出现数据丢失现象。



DMA直接访问：（direct memory access）

解决中断驱动IO的浪费CPU问题，提出DMA控制器

DMA传输时：CPU向内存中写入DMA命令块：源地址指针，目的地址指针，传输字节数，之后CPU可继续其他工作

DMA控制器直接控制内存总线，无需CPU帮助即可将地址放到总线开始传输。

优点：数据传送速度极快，CPU无需参与传送操作，直接在内存与外设之间进行，传送速率仅仅受到内存访问的限制。

缺点：对于离散块读取，会产生多次中断，当外设过多，CPU 管理DMA，当多个DMA同时使用时会引起内存地址冲突并且使得控制过程进一步复杂。引出专门用于I/O的硬件设备--通道。

通道：直接与存储器相连，受CPU控制

结构示意图

![image-20220624102705645](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624102705645.png)

原理示意图：

![image-20220624102825958](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624102825958.png)

优点：一个通道控制多个外设，与CPU并行工作

缺点：价格高，不宜过多使用。

适用于以字节为单位的I/O，同时实现cpu/通道/外设的并行操作。大型处理机。





#### 2. 设备缓冲区的原理、作用及单、双缓冲的计算。

略，见习题13章32题。

####  3. 设备分配的相关概念。 

通常只采用两种分配算法：
◦ 先来先服务：
◦ 优先级高者优先

分配策略：

独占设备：

将一个设备分配给某进程后便由该进程独占，直到该 进程完成或释放后，其它进程方能使用。缺点：设备利用率低， 可能引起死锁。

共享设备：

如磁盘、磁鼓之类的外存储器，可同时分配给多个进 程使用，但须对这些进程访问该设备的先后次序进行合理的调度。

虚拟设备:可虚拟的设备是指一台物理设备在采用虚拟技术以后，可变成多台逻辑上的所谓虚拟设备，因此，一台可虚拟设备是可共享的设备，可以将它同时分配给多个进程使用，并对这些访问
该（物理）设备的先后次序进行控制。

#### 4. 设备驱动程序的作用。

负责具体实现系统对设备发出的操作指令，驱动I/O 设备工作。与I/O设备的硬件结构密切联系

####  5. SPOOLing 系统组成与虚拟设备技术

spooling: SIMULTANEOUS PERIPHERAL OPERATION ON LINE (外设在线同步操作)。

SPOOLing技术是对脱机输入、输出系统的模拟：用 一道程序模拟脱机输入时外围控制机的功能，把低速 I/O设备上的数据传送到高速磁盘上；再用另一道程 序来模拟脱机输出时外围机的功能，把数据从磁盘传 送到低速的输出设备上。这样，便可在主机的直接控 制下，实现脱机输入、输出功能。此时的外围操作与 CPU对数据的处理同时进行。

spooling 组成：

输入井和输出井：磁盘上开辟的两个大存储空间。输 入井用于暂存I/O设备的输入数据；输出井用于暂存用 户程序的输出数据。

输入缓冲区和输出缓冲区：为缓和CPU和磁盘之间速度 不匹配的矛盾，在内存中开辟的两个缓冲区。输入缓 冲区用于暂存由输入设备送来的数据，以后再传送到 输入井；输出缓冲区用于暂存从输出井送来的数据， 以后再传送给输出设备。

  输入管理模块、输出管理模块 

 井管理程序。

![image-20220624104147206](C:\Users\wss\AppData\Roaming\Typora\typora-user-images\image-20220624104147206.png)

优点：

提高大量I/O请求速度，对对数据所进行的I/O操作，已从对低速I/O设备进 行的I/O操作，演变为对输入井或输出井中数据的存取，提高了 I/O速度，缓和了CPU与低速I/O设备之间速度不匹配的矛盾。

将独占设备改造为共享设备 

 实现了虚拟设备功能：宏观上，多个进程在同时使用一台独占设 备，对于每一个进程而言，都会认为自己独占了一个设备，而该 设备只是逻辑上的设备。
